<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>SLOT MACHINE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link rel="icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTXpgl9VrjKZLmPonXHSLJ8uLyNOPi7chR_Mtt0SCVJTx5-OI3J9WMJv_aO&s=10" sizes="16Ã—16" >
<style>
*{box-sizing:border-box}
body{
 margin:0;background:#111;color:#fff;
 font-family:system-ui,sans-serif;
 display:flex;justify-content:center;align-items:center;min-height:100vh;
}
#game{
 background:#222;padding:12px;border-radius:16px;
 width:min(460px,96vw);
}
.fullscreen #game{
 width:100vw;height:100vh;border-radius:0;
 display:flex;flex-direction:column;justify-content:center;
}
h1,h3{text-align:center;margin:6px 0}
#reels{display:flex;gap:8px;margin:10px 0}
.reel{
 flex:1;height:90px;background:#000;border-radius:12px;
 font-size:44px;display:flex;justify-content:center;align-items:center;
 box-shadow:inset 0 0 12px #666;
 transition:.15s;
}
.fullscreen .reel{height:120px;font-size:56px}

.flash{filter:brightness(2)}
.jackpotFx{animation:jack 0.4s infinite}
@keyframes jack{
 0%{filter:hue-rotate(0deg)}
 100%{filter:hue-rotate(360deg)}
}
.shake{animation:shake .3s}
@keyframes shake{
 0%{transform:translate(0)}
 25%{transform:translate(5px)}
 50%{transform:translate(-5px)}
 75%{transform:translate(5px)}
}

.controls{display:flex;gap:6px;margin-bottom:6px;flex-wrap:wrap}
button,select{
 flex:1;padding:10px;font-size:16px;border:none;border-radius:10px
}
button{background:#ffcc00}
.stop{background:#ff6666}
.auto{background:#66ccff}

#info{text-align:center;font-size:14px}
.win{color:#00ff88;font-weight:bold}
.jackpot{color:#ff66ff;font-weight:bold}

#history,#stats{
 background:#111;border-radius:10px;padding:6px;
 font-size:12px;margin-bottom:6px;max-height:120px;overflow:auto
}
.plus{color:#00ff88}
.minus{color:#ff6666}
</style>
</head>
<body>

<div id="game">
<h1>ğŸ° SLOT MACHINE</h1>

<div id="reels">
 <div class="reel" id="r1">â“</div>
 <div class="reel" id="r2">â“</div>
 <div class="reel" id="r3">â“</div>
</div>

<div class="controls">
 <button onclick="start()">START</button>
 <button class="stop" onclick="stopReel(0)">STOP</button>
 <button class="stop" onclick="stopReel(1)">STOP</button>
 <button class="stop" onclick="stopReel(2)">STOP</button>
</div>

<div class="controls">
 <select id="bet">
  <option value="10">BET 10</option>
  <option value="20">BET 20</option>
  <option value="50">BET 50</option>
 </select>
 <button onclick="toggleSound()">ğŸ”Š SOUND</button>
 <button onclick="toggleFull()">ğŸ–¥ FULL</button>
 <button class="auto" onclick="toggleAuto()">â–¶ AUTO</button>
</div>

<div class="controls">
 <button onclick="save()">ğŸ’¾ SAVE</button>
 <button onclick="clearAll()">ğŸ—‘ RESET</button>
</div>

<div id="info">
 ãƒ¡ãƒ€ãƒ«: <span id="medal"></span><br>
 <span id="msg"></span><br>
 <small>
 Space/Enter:START | 1-3:STOP | B:BET | S:SOUND | F:FULL | A:AUTO
 </small>
</div>

<h3>ğŸ“Š çµ±è¨ˆ</h3>
<div id="stats"></div>

<h3>ğŸ“œ å±¥æ­´</h3>
<div id="history"></div>
</div>

<script>
/* ===== è¨­å®š ===== */
const table=[
 {s:"ğŸ’",w:25},{s:"ğŸ‹",w:25},{s:"ğŸ””",w:18},
 {s:"â­",w:15},{s:"ğŸï¸",w:10},{s:"7ï¸âƒ£",w:5},{s:"ğŸ’",w:2}
];

let medal=100,sound=true;
let spinning=[false,false,false],timers=[];
let history=[];
let auto=false,autoTimer=null;
let stats={play:0,win:0,diff:0,max:0,streak:0,maxStreak:0};
let stopIndex=0;

const reels=[r1,r2,r3];

/* ===== SE ===== */
function se(f=600,t=80){
 if(!sound)return;
 const a=new AudioContext(),o=a.createOscillator();
 o.frequency.value=f;o.connect(a.destination);o.start();
 setTimeout(()=>{o.stop();a.close()},t);
}

/* ===== ã‚²ãƒ¼ãƒ  ===== */
function start(){
 if(spinning.some(v=>v))return;
 const bet=+betEl.value;
 if(medal<bet){msg("ãƒ¡ãƒ€ãƒ«ä¸è¶³");toggleAuto(false);return;}
 medal-=bet; stopIndex=0;
 reels.forEach((r,i)=>{
  spinning[i]=true;
  timers[i]=setInterval(()=>r.textContent=lot(),60+i*20);
 });
 update();se(400,120);
}

function stopReel(i){
 if(!spinning[i]||i!==stopIndex)return;
 clearInterval(timers[i]);
 spinning[i]=false;
 reels[i].classList.add("shake");
 se(800); stopIndex++;
 setTimeout(()=>reels[i].classList.remove("shake"),150);
 if(spinning.every(v=>!v))judge();
}

function judge(){
 stats.play++;
 const [a,b,c]=reels.map(r=>r.textContent);
 const bet=+betEl.value;
 let gain=0,text="ãƒã‚ºãƒ¬",cls="";

 reels.forEach(r=>r.classList.remove("flash","jackpotFx"));

 if(a===b&&b===c){
  let m=a==="ğŸ’"?100:a==="7ï¸âƒ£"?30:a==="ğŸï¸"?15:5;
  gain=bet*m; medal+=gain;
  text="ğŸ‰ BIG WIN x"+m;
  cls=a==="ğŸ’"?"jackpot":"win";
  stats.win++; stats.streak++;
  if(a==="ğŸ’")reels.forEach(r=>r.classList.add("jackpotFx"));
  else reels.forEach(r=>r.classList.add("flash"));
 }else if(a===b||b===c||a===c){
  gain=bet*2; medal+=gain;
  text="âœ¨ WIN x2"; cls="win";
  stats.win++; stats.streak++;
 }else stats.streak=0;

 stats.maxStreak=Math.max(stats.maxStreak,stats.streak);
 stats.max=Math.max(stats.max,gain);
 stats.diff+=gain-bet;

 history.unshift({
  t:new Date().toLocaleTimeString(),
  line:`${a}${b}${c} â†’ ${text}`,
  diff:gain-bet
 });
 history=history.slice(0,30);

 renderHistory();renderStats();
 msg(text,cls);update();
}

/* ===== AUTO ===== */
function toggleAuto(force){
 auto=force!==undefined?force:!auto;
 clearInterval(autoTimer);
 msg(auto?"â–¶ AUTO ON":"â–  AUTO OFF");
 if(!auto)return;
 autoTimer=setInterval(()=>{
  if(spinning.some(v=>v))return;
  start();
  setTimeout(()=>stopReel(0),600);
  setTimeout(()=>stopReel(1),900);
  setTimeout(()=>stopReel(2),1200);
 },1600);
}

/* ===== FULL ===== */
function toggleFull(){
 if(!document.fullscreenElement){
  document.documentElement.requestFullscreen();
  document.body.classList.add("fullscreen");
 }else{
  document.exitFullscreen();
  document.body.classList.remove("fullscreen");
 }
}

/* ===== è¡¨ç¤º ===== */
function lot(){
 let r=Math.random()*100,sum=0;
 for(let t of table){sum+=t.w;if(r<sum)return t.s}
}
function renderHistory(){
 historyEl.innerHTML=history.map(h=>{
  const c=h.diff>=0?"plus":"minus";
  return `<div>[${h.t}] ${h.line} <span class="${c}">(${h.diff})</span></div>`;
 }).join("");
}
function renderStats(){
 statsEl.innerHTML=
  `ç·å›è»¢: ${stats.play}<br>
   å‹åˆ©: ${stats.win}<br>
   å‹ç‡: ${stats.play?Math.round(stats.win/stats.play*100):0}%<br>
   æœ€å¤§ç²å¾—: ${stats.max}<br>
   æœ€å¤§é€£å‹: ${stats.maxStreak}<br>
   ç·å·®æš: ${stats.diff}`;
}
function update(){medalEl.textContent=medal}
function msg(t,c=""){msgEl.textContent=t;msgEl.className=c}

/* ===== SAVE ===== */
function save(){
 localStorage.setItem("slot",JSON.stringify({medal,history,stats,auto,sound}));
 msg("ã‚»ãƒ¼ãƒ–å®Œäº†");
}
function load(){
 const d=localStorage.getItem("slot");
 if(d){
  const o=JSON.parse(d);
  medal=o.medal||100;
  history=o.history||[];
  stats=o.stats||stats;
  auto=o.auto||false;
  sound=o.sound!==false;
 }
 renderHistory();renderStats();update();
 if(auto)toggleAuto(true);
}
function clearAll(){
 localStorage.removeItem("slot");
 medal=100;history=[];
 stats={play:0,win:0,diff:0,max:0,streak:0,maxStreak:0};
 toggleAuto(false);
 renderHistory();renderStats();update();
 msg("å®Œå…¨ãƒªã‚»ãƒƒãƒˆ");
}
function toggleSound(){sound=!sound;msg(sound?"ğŸ”ŠON":"ğŸ”‡OFF")}

/* ===== ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ ===== */
document.addEventListener("keydown",e=>{
 if(e.repeat)return;
 switch(e.key.toLowerCase()){
  case " ":
  case "enter": e.preventDefault(); start(); break;
  case "1": stopReel(0); break;
  case "2": stopReel(1); break;
  case "3": stopReel(2); break;
  case "b":
   betEl.selectedIndex=(betEl.selectedIndex+1)%betEl.length;
   msg("BETå¤‰æ›´: "+betEl.value);
   break;
  case "s": toggleSound(); break;
  case "f": toggleFull(); break;
  case "a": toggleAuto(); break;
 }
});

/* ===== DOM ===== */
const betEl=document.getElementById("bet");
const medalEl=document.getElementById("medal");
const msgEl=document.getElementById("msg");
const historyEl=document.getElementById("history");
const statsEl=document.getElementById("stats");

load();
</script>
</body>
</html>
